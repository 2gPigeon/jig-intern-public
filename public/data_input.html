<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>購入データの入力</title>
    <link rel="stylesheet" href="data_input.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
    <h1>購入データの入力をしよう</h1>
    
    <!-- 入力フォーム -->
    <form id="data-form">
        <label for="data">購入金額を入力してください:</label>
        <input type="number" id="data" name="data" max="1000000" min="1" required>円<br>
        
        <div class="location-section">
            <h3>購入した場所を選択してください</h3>
            <p>地図上でクリックするか、マーカーをドラッグして位置を指定してください</p>
            
            <!-- 地図を表示するコンテナ -->
            <div id="leaflet-map"></div>
            
            <!-- 緯度経度の入力フィールド -->
            <div class="coordinates-input">
                <label for="latitude">緯度:</label>
                <input type="number" id="latitude" name="latitude" step="0.000001" max="90" min="-90" required>
                
                <label for="longitude">経度:</label>
                <input type="number" id="longitude" name="longitude" step="0.000001" max="180" min="-180" required>
            </div>
        </div>
        
        <!-- 送信・戻るボタン -->
        <div class="button-group">
            <button type="submit" id="submit" disabled>送信</button>
            <button type="button" onclick="history.back()">戻る</button>
        </div>
    </form>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const dataInput = document.getElementById('data');
            const submitButton = document.getElementById('submit');
            
            // 入力値によってsubmitボタンの有効/無効を切り替え
            function toggleSubmit() {
                submitButton.disabled = !dataInput.value;
            }
            
            dataInput.addEventListener('input', toggleSubmit);
            toggleSubmit();
            
            // 地図の初期化
            const map = L.map('leaflet-map').setView([34.6937, 135.5023], 13);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
            
            // ドラッグ可能なマーカーを追加
            const marker = L.marker([34.6937, 135.5023], {
                draggable: true
            }).addTo(map);
            
            // マーカーの位置が変更されたときの処理
            function updateCoordinates(lat, lng) {
                document.getElementById('latitude').value = lat;
                document.getElementById('longitude').value = lng;
            }
            
            marker.on('dragend', function(e) {
                const position = marker.getLatLng();
                updateCoordinates(position.lat, position.lng);
            });
            
            map.on('click', function(e) {
                const lat = e.latlng.lat;
                const lng = e.latlng.lng;
                marker.setLatLng([lat, lng]);
                updateCoordinates(lat, lng);
            });
            
            // 初期値を設定
            updateCoordinates(34.6937, 135.5023);
        });
    </script>
</body>
</html>